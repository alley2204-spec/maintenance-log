<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sailboat Maintenance Log ‚Äì Lucia 40</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&family=JetBrains+Mono:wght@300;400;500&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --ink: #1a1a2e;
  --ink2: #16213e;
  --brass: #c9a84c;
  --brass2: #e8c96d;
  --rope: #8b7355;
  --sail: #f5f0e8;
  --sea: #2e6b8a;
  --sea2: #1a4a6b;
  --foam: #a8c8d8;
  --red: #c0392b;
  --amber: #d68910;
  --green: #1e8449;
  --paper: #faf7f2;
  --border: rgba(201,168,76,0.3);
  --hull-port: #1e3d5c;
  --hull-stbd: #1a3550;
  --deck: #243d58;
  --saloon: #2a4870;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--ink);
  color: var(--sail);
  font-family: 'Crimson Pro', serif;
  min-height: 100vh;
}
body::before {
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse 100% 60% at 50% 100%, rgba(46,107,138,0.25) 0%, transparent 70%),
    linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
  z-index:-1;
}

/* HEADER */
header {
  padding: 2rem 2rem 1.2rem;
  text-align: center;
  border-bottom: 1px solid var(--border);
}
.header-deco {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.3em;
  color: var(--brass);
  opacity: 0.7;
  text-transform: uppercase;
  margin-bottom: 0.4rem;
}
h1 {
  font-family: 'Libre Baskerville', serif;
  font-size: clamp(1.6rem, 3.5vw, 2.4rem);
  color: var(--brass2);
  letter-spacing: 0.04em;
}
h1 span { color: var(--sail); font-style: italic; font-weight: 400; }
.vessel-info {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-top: 0.8rem;
  flex-wrap: wrap;
}
.vessel-field { display:flex; align-items:center; gap:0.4rem; }
.vessel-field label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.15em;
  color: var(--brass);
  text-transform: uppercase;
}
.vessel-field input {
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--border);
  color: var(--sail);
  font-family: 'Crimson Pro', serif;
  font-size: 0.88rem;
  padding: 0.1rem 0.3rem;
  width: 130px;
  outline: none;
}
.vessel-field input:focus { border-bottom-color: var(--brass); }
.vessel-static {
  color: var(--sail);
  font-family: 'Crimson Pro', serif;
  font-size: 0.88rem;
  padding: 0.1rem 0.3rem;
}

/* TABS */
.tabs {
  display: flex;
  justify-content: center;
  padding: 1.2rem 2rem 0;
  border-bottom: 1px solid var(--border);
  max-width: 1300px;
  margin: 0 auto;
}
.tab {
  padding: 0.65rem 1.6rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--foam);
  opacity: 0.5;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  background: none;
  border-top: none; border-left: none; border-right: none;
}
.tab.active { color: var(--brass2); opacity: 1; border-bottom-color: var(--brass); }
.tab:hover:not(.active) { opacity: 0.8; }

/* PANELS */
.panel { display: none; padding: 1.5rem 2rem 3rem; max-width: 1300px; margin: 0 auto; }
.panel.active { display: block; }

/* ‚îÄ‚îÄ CATAMARAN DIAGRAM ‚îÄ‚îÄ */
.diagram-wrap {
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}
.diagram-title {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.63rem;
  letter-spacing: 0.2em;
  color: var(--brass);
  text-transform: uppercase;
  margin-bottom: 1rem;
  opacity: 0.8;
}

/* The isometric boat container */
.cat-diagram-container {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 620px;
}

svg.cat-iso {
  width: 100%;
  max-width: 820px;
  height: auto;
  filter: drop-shadow(0 12px 40px rgba(0,0,0,0.5));
}

/* HOTSPOTS */
.hs {
  position: absolute;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: 2px solid var(--brass);
  background: rgba(201,168,76,0.18);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  font-weight: 500;
  color: var(--brass2);
  transition: all 0.2s;
  transform: translate(-50%, -50%);
  z-index: 10;
  user-select: none;
}
.hs:hover { background: rgba(201,168,76,0.38); box-shadow: 0 0 14px rgba(201,168,76,0.5); }
.hs.ok   { border-color: #27ae60; color: #5dcc88; background: rgba(39,174,96,0.15); }
.hs.warn { border-color: var(--amber); color: #f0c050; background: rgba(214,137,16,0.18); }
.hs.bad  { border-color: var(--red); color: #e87e74; background: rgba(192,57,43,0.2); }

/* POPUP */
.hs-popup {
  display: none;
  position: absolute;
  background: #0f1e35;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.9rem 1.1rem;
  width: 210px;
  z-index: 30;
  box-shadow: 0 8px 28px rgba(0,0,0,0.6);
  left: 50%; top: calc(100% + 6px);
  transform: translateX(-50%);
}
.hs-popup.show { display: block; }
.popup-name {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.62rem;
  letter-spacing: 0.12em;
  color: var(--brass);
  text-transform: uppercase;
  margin-bottom: 0.45rem;
}
.popup-status-row {
  display: flex; align-items: center; gap: 0.35rem;
  font-size: 0.78rem; margin-bottom: 0.45rem;
}
.sdot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
.sdot.ok { background: #27ae60; }
.sdot.warn { background: var(--amber); }
.sdot.bad { background: var(--red); }
.popup-select, .popup-note-input {
  width: 100%;
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--sail);
  font-family: 'Crimson Pro', serif;
  font-size: 0.82rem;
  padding: 0.28rem 0.45rem;
  outline: none;
  margin-top: 0.35rem;
}
.popup-select option { background: #0f1e35; }
.popup-note-input::placeholder { color: var(--foam); opacity: 0.4; }

/* Legend */
.legend {
  display: flex; gap: 1.5rem; justify-content: center;
  margin-top: 1rem; flex-wrap: wrap;
}
.leg-item {
  display: flex; align-items: center; gap: 0.4rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.62rem; letter-spacing: 0.06em;
  color: var(--foam); opacity: 0.7;
}
.leg-dot {
  width: 12px; height: 12px; border-radius: 50%; border: 2px solid;
  display:flex; align-items:center; justify-content:center;
}

/* Compass rose label */
.compass-label {
  position: absolute;
  top: 10px; right: 14px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.58rem;
  color: var(--brass);
  opacity: 0.5;
  text-align: center;
  letter-spacing: 0.05em;
}

/* ‚îÄ‚îÄ LOG TABLE ‚îÄ‚îÄ */
.log-controls, .bom-controls {
  display: flex; gap: 0.8rem; margin-bottom: 1.2rem;
  flex-wrap: wrap; align-items: center;
}
.btn {
  padding: 0.45rem 1.1rem;
  border-radius: 6px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.66rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid var(--border);
  background: rgba(201,168,76,0.08);
  color: var(--brass2);
}
.btn:hover { background: rgba(201,168,76,0.2); border-color: var(--brass); }
.btn.primary { background: var(--brass); color: var(--ink); border-color: var(--brass); font-weight:500; }
.btn.primary:hover { background: var(--brass2); }
.filter-select {
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--border); border-radius:6px;
  color: var(--foam);
  font-family: 'JetBrains Mono', monospace; font-size:0.66rem;
  padding: 0.45rem 0.75rem; outline:none; cursor:pointer;
}
.filter-select option { background: var(--ink2); }
.log-table-wrap { overflow-x:auto; border:1px solid var(--border); border-radius:10px; }
table { width:100%; border-collapse:collapse; font-size:0.87rem; }
thead tr { background: rgba(201,168,76,0.07); border-bottom:1px solid var(--border); }
th {
  font-family:'JetBrains Mono',monospace; font-size:0.58rem;
  letter-spacing:0.14em; text-transform:uppercase; color:var(--brass);
  padding:0.75rem 0.9rem; text-align:left; font-weight:400; white-space:nowrap;
}
td { padding:0.7rem 0.9rem; border-bottom:1px solid rgba(201,168,76,0.07); vertical-align:middle; color:var(--sail); }
tr:last-child td { border-bottom:none; }
tr:hover td { background:rgba(255,255,255,0.02); }
td[contenteditable="true"] { outline:none; cursor:text; }
td[contenteditable="true"]:focus { background:rgba(201,168,76,0.08); border-radius:3px; }
.badge {
  display:inline-block; padding:0.13rem 0.5rem; border-radius:20px;
  font-family:'JetBrains Mono',monospace; font-size:0.58rem; letter-spacing:0.05em; font-weight:500;
}
.badge.routine { background:rgba(46,107,138,0.3); color:var(--foam); }
.badge.repair  { background:rgba(192,57,43,0.3); color:#e87e74; }
.badge.inspect { background:rgba(214,137,16,0.3); color:#f0c050; }
.badge.upgrade { background:rgba(30,132,73,0.3); color:#5dcc88; }
.del-btn { background:none; border:none; color:var(--red); opacity:0.35; cursor:pointer; font-size:1rem; padding:0.2rem; transition:opacity 0.2s; }
.del-btn:hover { opacity:1; }

/* BOM stats */
.bom-stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:1rem; margin-bottom:1.2rem; }
.stat-card { background:rgba(255,255,255,0.03); border:1px solid var(--border); border-radius:8px; padding:0.9rem 1.1rem; }
.stat-label { font-family:'JetBrains Mono',monospace; font-size:0.57rem; letter-spacing:0.14em; color:var(--brass); text-transform:uppercase; opacity:0.8; margin-bottom:0.25rem; }
.stat-value { font-family:'Libre Baskerville',serif; font-size:1.4rem; color:var(--brass2); }
.stat-sub { font-size:0.72rem; color:var(--foam); opacity:0.5; margin-top:0.1rem; }
.search-input {
  background:rgba(255,255,255,0.04); border:1px solid var(--border); border-radius:6px;
  color:var(--sail); font-family:'Crimson Pro',serif; font-size:0.87rem;
  padding:0.45rem 0.85rem; outline:none; width:200px;
}
.search-input::placeholder { color:var(--foam); opacity:0.4; }
.search-input:focus { border-color:var(--brass); }

/* MODAL */
.modal-overlay {
  display:none; position:fixed; inset:0;
  background:rgba(8,14,28,0.88); z-index:100;
  align-items:center; justify-content:center; padding:1rem;
}
.modal-overlay.show { display:flex; }
.modal {
  background:var(--ink2); border:1px solid var(--border); border-radius:12px;
  padding:1.8rem; width:100%; max-width:540px; max-height:90vh; overflow-y:auto;
}
.modal h3 { font-family:'Libre Baskerville',serif; color:var(--brass2); font-size:1.15rem; margin-bottom:1.3rem; padding-bottom:0.7rem; border-bottom:1px solid var(--border); }
.form-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.9rem; }
.form-group { display:flex; flex-direction:column; gap:0.35rem; }
.form-group.full { grid-column:1/-1; }
.form-group label { font-family:'JetBrains Mono',monospace; font-size:0.58rem; letter-spacing:0.14em; color:var(--brass); text-transform:uppercase; opacity:0.8; }
.form-group input,.form-group select,.form-group textarea {
  background:rgba(255,255,255,0.04); border:1px solid var(--border); border-radius:6px;
  color:var(--sail); font-family:'Crimson Pro',serif; font-size:0.88rem;
  padding:0.5rem 0.75rem; outline:none; transition:border-color 0.2s;
}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus { border-color:var(--brass); }
.form-group select option { background:var(--ink2); }
.form-group textarea { resize:vertical; min-height:65px; }
.modal-actions { display:flex; gap:0.7rem; justify-content:flex-end; margin-top:1.3rem; padding-top:0.9rem; border-bottom:none; border-top:1px solid var(--border); }

::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(201,168,76,0.25); border-radius:3px; }

@media(max-width:600px){
  /* ‚îÄ‚îÄ Foundations ‚îÄ‚îÄ */
  .form-grid{grid-template-columns:1fr;}
  .cat-diagram-container{min-height:400px;}

  /* ‚îÄ‚îÄ Header: compact 2-col vessel grid ‚îÄ‚îÄ */
  header{padding:0.9rem 1rem 0.65rem;}
  h1{font-size:clamp(1.25rem,5.5vw,1.7rem);}
  .vessel-info{display:grid;grid-template-columns:1fr 1fr;gap:0.4rem 0.5rem;margin-top:0.5rem;justify-content:unset;}
  .vessel-field{flex-direction:column;gap:0.08rem;}
  .vessel-field input, .vessel-static{width:100%;font-size:0.82rem;}

  /* ‚îÄ‚îÄ Tabs: equal-width, stretch across ‚îÄ‚îÄ */
  .tabs{gap:0;padding:0.5rem 0 0;justify-content:stretch;}
  .tab{padding:0.6rem 0;font-size:0.59rem;letter-spacing:0.04em;flex:1;text-align:center;white-space:nowrap;}

  /* ‚îÄ‚îÄ Panel ‚îÄ‚îÄ */
  .panel{padding:1.1rem 0.75rem 5.5rem;}

  /* ‚îÄ‚îÄ Diagram ‚îÄ‚îÄ */
  .diagram-wrap{padding:0.9rem 0.4rem 0.75rem;}
  .diagram-title{font-size:0.56rem;letter-spacing:0.1em;margin-bottom:0.7rem;}

  /* ‚îÄ‚îÄ Hotspots: larger touch targets ‚îÄ‚îÄ */
  .hs{width:34px;height:34px;font-size:0.47rem;}
  .hs-popup{width:188px;}
  .legend{gap:0.6rem 1rem;margin-top:0.65rem;}

  /* ‚îÄ‚îÄ Buttons & form controls: min 44px ‚îÄ‚îÄ */
  .btn{min-height:44px;padding:0.55rem 0.85rem;}
  .filter-select{min-height:44px;font-size:0.75rem;padding:0.45rem 0.6rem;}
  .search-input{width:100%;min-height:44px;}
  .log-controls,.bom-controls{gap:0.5rem;}
  .del-btn{font-size:1.1rem;padding:0.3rem 0.5rem;min-width:36px;}

  /* ‚îÄ‚îÄ LOG TABLE ‚Üí Card layout ‚îÄ‚îÄ */
  #panel-log .log-table-wrap{border:none;background:transparent;border-radius:0;}
  #panel-log .log-table-wrap thead{display:none;}
  #panel-log .log-table-wrap tbody tr{
    display:grid;grid-template-columns:1fr 1fr;gap:0 0.5rem;
    background:rgba(255,255,255,0.025);border:1px solid var(--border);
    border-radius:10px;padding:0.75rem 0.85rem 0.45rem;margin-bottom:0.65rem;
  }
  #panel-log .log-table-wrap tbody tr:hover td{background:transparent;}
  #panel-log .log-table-wrap tbody td{
    display:flex;flex-direction:column;gap:0.15rem;
    padding:0.2rem 0;border:none;font-size:0.85rem;
  }
  #panel-log .log-table-wrap tbody td::before{
    content:attr(data-label);font-family:'JetBrains Mono',monospace;
    font-size:0.5rem;letter-spacing:0.12em;color:var(--brass);
    text-transform:uppercase;opacity:0.75;
  }
  #panel-log .log-table-wrap tbody td[data-label="TASK"],
  #panel-log .log-table-wrap tbody td[data-label="NOTES"],
  #panel-log .log-table-wrap tbody td[data-label=""]{grid-column:1/-1;}
  #panel-log .log-table-wrap tbody td[data-label=""]{
    flex-direction:row;justify-content:flex-end;
    padding-top:0.3rem;border-top:1px solid rgba(201,168,76,0.08);margin-top:0.2rem;
  }
  #panel-log .log-table-wrap tbody td[data-label=""]::before{display:none;}

  /* ‚îÄ‚îÄ BOM STATS: 3-col row ‚îÄ‚îÄ */
  .bom-stats{grid-template-columns:repeat(3,1fr);gap:0.4rem;}
  .stat-card{padding:0.55rem 0.6rem;}
  .stat-label{font-size:0.5rem;}
  .stat-value{font-size:1.05rem;}

  /* ‚îÄ‚îÄ BOM TABLE ‚Üí Card layout ‚îÄ‚îÄ */
  #panel-bom .log-table-wrap{border:none;background:transparent;border-radius:0;}
  #panel-bom .log-table-wrap thead{display:none;}
  #panel-bom .log-table-wrap tbody tr{
    display:grid;grid-template-columns:1fr 1fr;gap:0 0.5rem;
    background:rgba(255,255,255,0.025);border:1px solid var(--border);
    border-radius:10px;padding:0.75rem 0.85rem 0.45rem;margin-bottom:0.65rem;
  }
  #panel-bom .log-table-wrap tbody tr:hover td{background:transparent;}
  #panel-bom .log-table-wrap tbody td{
    display:flex;flex-direction:column;gap:0.15rem;
    padding:0.2rem 0;border:none;font-size:0.85rem;
  }
  #panel-bom .log-table-wrap tbody td::before{
    content:attr(data-label);font-family:'JetBrains Mono',monospace;
    font-size:0.5rem;letter-spacing:0.12em;color:var(--brass);
    text-transform:uppercase;opacity:0.75;
  }
  #panel-bom .log-table-wrap tbody td[data-label="#"]{display:none;}
  #panel-bom .log-table-wrap tbody td[data-label="PART NAME"],
  #panel-bom .log-table-wrap tbody td[data-label="SUPPLIER"],
  #panel-bom .log-table-wrap tbody td[data-label="NOTES"],
  #panel-bom .log-table-wrap tbody td[data-label=""]{grid-column:1/-1;}
  #panel-bom .log-table-wrap tbody td[data-label=""]{
    flex-direction:row;justify-content:flex-end;
    padding-top:0.3rem;border-top:1px solid rgba(201,168,76,0.08);margin-top:0.2rem;
  }
  #panel-bom .log-table-wrap tbody td[data-label=""]::before{display:none;}

  /* ‚îÄ‚îÄ Modals: slide up from bottom ‚îÄ‚îÄ */
  .modal-overlay.show{align-items:flex-end;padding:0;}
  .modal{border-radius:16px 16px 0 0;max-height:88vh;max-width:100%;padding:1.3rem 1.1rem 1.5rem;}
  .modal::before{content:'';display:block;width:36px;height:4px;background:rgba(255,255,255,0.18);border-radius:2px;margin:0 auto 1rem;}

  /* ‚îÄ‚îÄ Backup bar: icon-only ‚îÄ‚îÄ */
  #backupBar{bottom:0.7rem;left:0.7rem;gap:0.3rem;}
  #backupBar button{padding:0.4rem 0.55rem;border-radius:18px;}
  #backupBar .bb-text{display:none;}
  #saveIndicator{bottom:0.7rem;right:0.7rem;}
  /* schedule mobile overrides */
  .hours-card{padding:0.5rem 0.25rem;}
  .hours-card input{font-size:1rem;}
  .sch-input-group input{min-height:40px;}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCHEDULE PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.hours-overview{display:grid;grid-template-columns:repeat(3,1fr);gap:0.6rem;margin-bottom:1.1rem;}
.hours-card{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:8px;padding:0.65rem 0.5rem;text-align:center;}
.hours-card label{font-family:'JetBrains Mono',monospace;font-size:0.5rem;letter-spacing:0.1em;color:var(--brass);text-transform:uppercase;display:block;margin-bottom:0.25rem;}
.hours-card input{background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--brass2);font-family:'Libre Baskerville',serif;font-size:1.15rem;text-align:center;width:100%;outline:none;padding:0.1rem 0;}
.hours-card input:focus{border-bottom-color:var(--brass);}
.hrs-unit{font-family:'JetBrains Mono',monospace;font-size:0.42rem;letter-spacing:0.1em;color:var(--foam);opacity:0.4;margin-top:0.15rem;}
.sch-summary{display:flex;gap:0.6rem;flex-wrap:wrap;margin-bottom:1rem;}
.sch-badge{font-family:'JetBrains Mono',monospace;font-size:0.58rem;letter-spacing:0.04em;padding:0.22rem 0.6rem;border-radius:12px;}
.sch-badge.ok{background:rgba(39,174,96,0.15);color:#5dcc88;}
.sch-badge.warn{background:rgba(214,137,16,0.18);color:#f0c050;}
.sch-badge.bad{background:rgba(192,57,43,0.2);color:#e87e74;}
.sch-badge.neutral{background:rgba(46,107,138,0.2);color:var(--foam);opacity:0.75;}
.sch-section{margin-bottom:1.5rem;}
.sch-section-title{font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:0.15em;color:var(--brass);text-transform:uppercase;padding:0.45rem 0;border-bottom:1px solid var(--border);margin-bottom:0.75rem;}
.sch-item{background:rgba(255,255,255,0.025);border:1px solid var(--border);border-left:3px solid rgba(168,200,216,0.25);border-radius:8px;padding:0.7rem 0.85rem;margin-bottom:0.5rem;}
.sch-item.ok{border-left-color:#27ae60;}
.sch-item.warn{border-left-color:var(--amber);}
.sch-item.bad{border-left-color:var(--red);}
.sch-item.neutral{border-left-color:var(--sea);}
.sch-task{font-size:0.88rem;color:var(--sail);margin-bottom:0.18rem;font-weight:500;}
.sch-interval{font-family:'JetBrains Mono',monospace;font-size:0.5rem;letter-spacing:0.08em;color:var(--foam);opacity:0.55;margin-bottom:0.45rem;}
.sch-inputs{display:grid;grid-template-columns:1fr 1fr;gap:0.4rem;margin-bottom:0.4rem;}
.sch-input-group{display:flex;flex-direction:column;gap:0.12rem;}
.sch-input-group label{font-family:'JetBrains Mono',monospace;font-size:0.47rem;letter-spacing:0.1em;color:var(--brass);text-transform:uppercase;opacity:0.7;}
.sch-input-group input{background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:4px;color:var(--sail);font-family:'Crimson Pro',serif;font-size:0.82rem;padding:0.25rem 0.4rem;outline:none;width:100%;}
.sch-input-group input:focus{border-color:var(--brass);}
.sch-status{font-family:'JetBrains Mono',monospace;font-size:0.55rem;letter-spacing:0.03em;padding-top:0.3rem;border-top:1px solid rgba(201,168,76,0.07);}
.sch-status.ok{color:#5dcc88;}
.sch-status.warn{color:#f0c050;}
.sch-status.bad{color:#e87e74;}
.sch-status.neutral{color:var(--foam);opacity:0.5;}
</style>
</head>
<body>

<header>
  <div class="header-deco">‚öì Fountaine Pajot ¬∑ Catamaran Maintenance System</div>
  <h1>Lucia 40 <span>Maintenance Log</span></h1>
  <div class="vessel-info">
    <div class="vessel-field"><label>Vessel</label><span class="vessel-static">S/V OceanNomad</span></div>
    <div class="vessel-field"><label>Year</label><span class="vessel-static">2019</span></div>
  </div>
</header>

<div class="tabs">
  <button class="tab active" onclick="switchTab('diagram')">üó∫ ËàπÊ≥ÅÂúñ</button>
  <button class="tab" onclick="switchTab('log')">üìã Á∂≠Ë≠∑Ë®òÈåÑ</button>
  <button class="tab" onclick="switchTab('bom')">üî© BOM Èõ∂‰ª∂Ë°®</button>
  <button class="tab" onclick="switchTab('schedule')">‚öô ‰øùÈ§äÊôÇÁ®ã</button>
</div>

<!-- ‚ïê‚ïê DIAGRAM ‚ïê‚ïê -->
<div class="panel active" id="panel-diagram">
<div class="diagram-wrap">
  <div class="diagram-title">‚¨° Fountaine Pajot Lucia 40 ‚Äî Áî≤ÊùøÂπ≥Èù¢ËàπÊ≥ÅÂúñ ¬∑ ÈªûÊìäÂêÑÂçÄÂüüÊü•ÁúãÔºèÁ∑®ËºØÁãÄÊÖã</div>

  <div class="cat-diagram-container" id="catWrap">
    <div class="compass-label">BOW ‚ñ≤<br>PORT ‚óÄ ‚ñ∂ STBD</div>

    <!--
      LUCIA 40 FLAT TOP-DOWN DECK PLAN SVG
      LOA 11.73m √ó Beam 6.63m
      Architectural floor plan style ‚Äî bow at top
    -->
    <svg class="cat-iso" viewBox="0 0 800 700" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <style>
          .hull-line { fill: none; stroke: rgba(168,200,216,0.55); stroke-width: 1.2; }
          .wall { fill: none; stroke: rgba(168,200,216,0.4); stroke-width: 0.8; }
          .wall-thick { fill: none; stroke: rgba(168,200,216,0.5); stroke-width: 1.0; }
          .furniture { fill: rgba(168,200,216,0.06); stroke: rgba(168,200,216,0.3); stroke-width: 0.7; }
          .bed { fill: rgba(168,200,216,0.08); stroke: rgba(168,200,216,0.35); stroke-width: 0.7; }
          .glass { fill: rgba(168,213,226,0.1); stroke: rgba(80,144,176,0.5); stroke-width: 0.6; }
          .deck-fill { fill: rgba(30,61,92,0.25); }
          .hull-fill { fill: rgba(26,53,80,0.35); }
          .tram-fill { fill: rgba(28,51,72,0.2); }
          .label { font-family: 'JetBrains Mono',monospace; fill: rgba(168,213,226,0.3); letter-spacing: 2px; }
          .dim-label { font-family: 'JetBrains Mono',monospace; fill: rgba(201,168,76,0.35); }
          .detail-line { stroke: rgba(168,200,216,0.25); stroke-width: 0.5; fill: none; }
        </style>
      </defs>

      <!-- ‚ïê‚ïê‚ïê PORT HULL (left) ‚ïê‚ïê‚ïê -->
      <path class="hull-fill" d="M 110,95 C 110,60 140,28 175,18 L 175,18 C 210,28 240,60 240,95 L 240,600 C 240,622 220,645 175,655 C 130,645 110,622 110,600 Z"/>
      <path class="hull-line" d="M 110,95 C 110,60 140,28 175,18 C 210,28 240,60 240,95 L 240,600 C 240,622 220,645 175,655 C 130,645 110,622 110,600 Z"/>
      <!-- Port hull interior walls -->
      <!-- Forepeak bulkhead -->
      <line class="wall" x1="115" y1="105" x2="235" y2="105"/>
      <!-- Fwd cabin / head partition -->
      <line class="wall" x1="115" y1="200" x2="235" y2="200"/>
      <!-- Head / passage partition -->
      <line class="wall" x1="115" y1="250" x2="235" y2="250"/>
      <!-- Center passage walls -->
      <line class="wall" x1="115" y1="310" x2="235" y2="310"/>
      <!-- Aft cabin front -->
      <line class="wall" x1="115" y1="410" x2="235" y2="410"/>
      <!-- Aft cabin / engine bulkhead -->
      <line class="wall" x1="115" y1="530" x2="235" y2="530"/>
      <!-- Engine / stern bulkhead -->
      <line class="wall" x1="115" y1="580" x2="235" y2="580"/>
      <!-- Hull centerline (corridor) -->
      <line class="detail-line" x1="175" y1="200" x2="175" y2="310" stroke-dasharray="3,3"/>

      <!-- Port Forward Cabin ‚Äî V-berth bed -->
      <path class="bed" d="M 128,115 L 165,115 L 175,135 L 185,115 L 222,115 L 222,190 L 128,190 Z"/>
      <!-- Pillow shapes -->
      <rect class="bed" x="132" y="118" width="30" height="16" rx="4"/>
      <rect class="bed" x="188" y="118" width="30" height="16" rx="4"/>

      <!-- Port Head (bathroom) -->
      <!-- Toilet -->
      <ellipse class="furniture" cx="148" cy="225" rx="10" ry="12"/>
      <!-- Sink -->
      <rect class="furniture" x="190" y="210" width="22" height="18" rx="4"/>
      <!-- Shower tray -->
      <rect class="furniture" x="185" y="232" width="30" height="16" rx="2" stroke-dasharray="2,2"/>

      <!-- Port Aft Cabin ‚Äî Double berth -->
      <rect class="bed" x="125" y="425" width="100" height="95" rx="5"/>
      <!-- Pillows -->
      <rect class="bed" x="130" y="428" width="38" height="18" rx="5"/>
      <rect class="bed" x="182" y="428" width="38" height="18" rx="5"/>
      <!-- Hanging locker -->
      <rect class="furniture" x="120" y="415" width="25" height="15" rx="2"/>

      <!-- Port Engine room -->
      <rect class="furniture" x="145" y="545" width="60" height="28" rx="3"/>
      <text x="175" y="563" text-anchor="middle" class="label" font-size="6">ENG</text>

      <!-- ‚ïê‚ïê‚ïê STARBOARD HULL (right) ‚ïê‚ïê‚ïê -->
      <path class="hull-fill" d="M 560,95 C 560,60 590,28 625,18 L 625,18 C 660,28 690,60 690,95 L 690,600 C 690,622 670,645 625,655 C 580,645 560,622 560,600 Z"/>
      <path class="hull-line" d="M 560,95 C 560,60 590,28 625,18 C 660,28 690,60 690,95 L 690,600 C 690,622 670,645 625,655 C 580,645 560,622 560,600 Z"/>
      <!-- Stbd hull interior walls -->
      <line class="wall" x1="565" y1="105" x2="685" y2="105"/>
      <line class="wall" x1="565" y1="200" x2="685" y2="200"/>
      <line class="wall" x1="565" y1="250" x2="685" y2="250"/>
      <line class="wall" x1="565" y1="310" x2="685" y2="310"/>
      <line class="wall" x1="565" y1="410" x2="685" y2="410"/>
      <line class="wall" x1="565" y1="530" x2="685" y2="530"/>
      <line class="wall" x1="565" y1="580" x2="685" y2="580"/>
      <line class="detail-line" x1="625" y1="200" x2="625" y2="310" stroke-dasharray="3,3"/>

      <!-- Stbd Forward Cabin ‚Äî V-berth bed -->
      <path class="bed" d="M 578,115 L 615,115 L 625,135 L 635,115 L 672,115 L 672,190 L 578,190 Z"/>
      <rect class="bed" x="582" y="118" width="30" height="16" rx="4"/>
      <rect class="bed" x="638" y="118" width="30" height="16" rx="4"/>

      <!-- Stbd Head -->
      <ellipse class="furniture" cx="648" cy="225" rx="10" ry="12"/>
      <rect class="furniture" x="588" y="210" width="22" height="18" rx="4"/>
      <rect class="furniture" x="585" y="232" width="30" height="16" rx="2" stroke-dasharray="2,2"/>

      <!-- Stbd Aft Cabin -->
      <rect class="bed" x="575" y="425" width="100" height="95" rx="5"/>
      <rect class="bed" x="580" y="428" width="38" height="18" rx="5"/>
      <rect class="bed" x="632" y="428" width="38" height="18" rx="5"/>
      <rect class="furniture" x="655" y="415" width="25" height="15" rx="2"/>

      <!-- Stbd Engine room -->
      <rect class="furniture" x="595" y="545" width="60" height="28" rx="3"/>
      <text x="625" y="563" text-anchor="middle" class="label" font-size="6">ENG</text>

      <!-- ‚ïê‚ïê‚ïê BRIDGE DECK ‚ïê‚ïê‚ïê -->
      <!-- Trampoline / foredeck netting -->
      <rect class="tram-fill" x="240" y="85" width="320" height="140" rx="3"/>
      <rect style="fill:none;stroke:rgba(168,200,216,0.2);stroke-width:0.8" x="240" y="85" width="320" height="140" rx="3"/>
      <!-- Netting lines -->
      <line x1="280" y1="86" x2="280" y2="224" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="340" y1="86" x2="340" y2="224" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="400" y1="86" x2="400" y2="224" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="460" y1="86" x2="460" y2="224" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="520" y1="86" x2="520" y2="224" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="241" y1="120" x2="559" y2="120" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="241" y1="155" x2="559" y2="155" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>
      <line x1="241" y1="190" x2="559" y2="190" stroke="rgba(168,200,216,0.1)" stroke-width="0.5"/>

      <!-- Bow connecting structure -->
      <path style="fill:rgba(30,61,92,0.2);stroke:rgba(168,200,216,0.4);stroke-width:0.8" d="M 240,75 L 400,15 L 560,75 L 560,90 L 240,90 Z"/>

      <!-- Main bridge deck area -->
      <rect class="deck-fill" x="240" y="225" width="320" height="310" rx="2"/>
      <rect style="fill:none;stroke:rgba(168,200,216,0.45);stroke-width:1" x="240" y="225" width="320" height="310"/>

      <!-- Saloon outer walls (cabin house) -->
      <rect style="fill:rgba(46,90,128,0.15);stroke:rgba(168,200,216,0.5);stroke-width:1.2" x="255" y="230" width="290" height="190" rx="3"/>

      <!-- Forward windshield windows -->
      <rect class="glass" x="290" y="231" width="55" height="10" rx="2"/>
      <rect class="glass" x="355" y="231" width="90" height="10" rx="2"/>
      <rect class="glass" x="455" y="231" width="55" height="10" rx="2"/>

      <!-- Port side windows -->
      <rect class="glass" x="256" y="260" width="8" height="35" rx="2"/>
      <rect class="glass" x="256" y="310" width="8" height="35" rx="2"/>
      <rect class="glass" x="256" y="360" width="8" height="35" rx="2"/>
      <!-- Stbd side windows -->
      <rect class="glass" x="536" y="260" width="8" height="35" rx="2"/>
      <rect class="glass" x="536" y="310" width="8" height="35" rx="2"/>
      <rect class="glass" x="536" y="360" width="8" height="35" rx="2"/>

      <!-- ‚îÄ‚îÄ SALOON INTERIOR ‚îÄ‚îÄ -->
      <!-- Navigation station (port forward) -->
      <rect class="furniture" x="270" y="248" width="55" height="30" rx="2"/>
      <text x="297" y="267" text-anchor="middle" class="label" font-size="5">NAV</text>

      <!-- Galley (port side) -->
      <!-- Counter L-shape -->
      <path class="furniture" d="M 270,290 L 270,390 L 320,390 L 320,330 L 290,330 L 290,290 Z"/>
      <!-- Stove burners -->
      <circle class="furniture" cx="280" cy="310" r="5"/>
      <circle class="furniture" cx="280" cy="325" r="5"/>
      <!-- Sink -->
      <rect class="furniture" x="295" y="345" width="20" height="15" rx="3"/>
      <!-- Fridge -->
      <rect class="furniture" x="295" y="370" width="22" height="18" rx="2"/>
      <text x="306" y="382" text-anchor="middle" class="label" font-size="4.5">FRIDGE</text>

      <!-- Salon seating ‚Äî L-shaped sofa (stbd) -->
      <path class="furniture" d="M 430,255 L 530,255 L 530,390 L 510,390 L 510,275 L 430,275 Z"/>
      <!-- Cushion lines -->
      <line class="detail-line" x1="510" y1="290" x2="530" y2="290"/>
      <line class="detail-line" x1="510" y1="320" x2="530" y2="320"/>
      <line class="detail-line" x1="510" y1="350" x2="530" y2="350"/>

      <!-- Dining table -->
      <rect class="furniture" x="350" y="280" width="70" height="50" rx="5"/>

      <!-- Salon forward seating (port of table) -->
      <rect class="furniture" x="335" y="265" width="50" height="12" rx="3"/>

      <!-- Door to cockpit -->
      <rect class="glass" x="370" y="415" width="60" height="6" rx="1"/>

      <!-- ‚îÄ‚îÄ COCKPIT ‚îÄ‚îÄ -->
      <rect style="fill:rgba(30,55,80,0.2)" x="255" y="425" width="290" height="100"/>
      <rect style="fill:none;stroke:rgba(168,200,216,0.35);stroke-width:0.8" x="255" y="425" width="290" height="100"/>

      <!-- Cockpit seating ‚Äî U-shape -->
      <path class="furniture" d="M 270,435 L 270,515 L 530,515 L 530,435 L 510,435 L 510,500 L 290,500 L 290,435 Z"/>
      <!-- Seat cushion lines -->
      <line class="detail-line" x1="270" y1="460" x2="290" y2="460"/>
      <line class="detail-line" x1="270" y1="485" x2="290" y2="485"/>
      <line class="detail-line" x1="510" y1="460" x2="530" y2="460"/>
      <line class="detail-line" x1="510" y1="485" x2="530" y2="485"/>
      <line class="detail-line" x1="330" y1="500" x2="330" y2="515"/>
      <line class="detail-line" x1="400" y1="500" x2="400" y2="515"/>
      <line class="detail-line" x1="470" y1="500" x2="470" y2="515"/>

      <!-- Cockpit table -->
      <rect class="furniture" x="340" y="450" width="120" height="40" rx="5"/>

      <!-- Helm station (stbd aft) -->
      <rect style="fill:rgba(30,60,85,0.3);stroke:rgba(168,200,216,0.4);stroke-width:0.8" x="500" y="530" width="50" height="35" rx="4"/>
      <!-- Wheel -->
      <circle style="fill:none;stroke:rgba(201,168,76,0.5);stroke-width:1" cx="525" cy="547" r="12"/>
      <circle style="fill:rgba(201,168,76,0.3)" cx="525" cy="547" r="3"/>

      <!-- ‚îÄ‚îÄ TRANSOM / SWIM PLATFORM ‚îÄ‚îÄ -->
      <path style="fill:rgba(26,48,72,0.3);stroke:rgba(168,200,216,0.4);stroke-width:0.8" d="M 240,570 L 560,570 L 570,610 Q 570,640 550,645 L 250,645 Q 230,640 230,610 Z"/>
      <!-- Stern steps -->
      <rect class="furniture" x="280" y="615" width="50" height="22" rx="3"/>
      <rect class="furniture" x="470" y="615" width="50" height="22" rx="3"/>
      <!-- Outboard / dinghy davits -->
      <rect class="furniture" x="370" y="600" width="60" height="30" rx="4"/>

      <!-- ‚ïê‚ïê‚ïê MAST ‚ïê‚ïê‚ïê -->
      <circle style="fill:rgba(201,168,76,0.8);stroke:#a08030;stroke-width:1.5" cx="400" cy="215" r="5"/>
      <!-- Forestay -->
      <line x1="400" y1="210" x2="400" y2="18" stroke="rgba(138,117,69,0.4)" stroke-width="0.8"/>
      <!-- Shrouds -->
      <line x1="400" y1="215" x2="240" y2="215" stroke="rgba(138,117,69,0.25)" stroke-width="0.6"/>
      <line x1="400" y1="215" x2="560" y2="215" stroke="rgba(138,117,69,0.25)" stroke-width="0.6"/>
      <!-- Boom -->
      <line x1="400" y1="215" x2="400" y2="390" stroke="rgba(160,128,48,0.4)" stroke-width="2" stroke-linecap="round"/>

      <!-- ‚ïê‚ïê‚ïê NAVIGATION LIGHTS ‚ïê‚ïê‚ïê -->
      <circle cx="240" cy="78" r="3.5" fill="rgba(192,57,43,0.8)" stroke="#8a2020" stroke-width="0.7"/>
      <circle cx="560" cy="78" r="3.5" fill="rgba(39,174,96,0.8)" stroke="#1a7a40" stroke-width="0.7"/>

      <!-- Anchor windlass -->
      <rect style="fill:rgba(100,130,150,0.25);stroke:rgba(74,96,112,0.5);stroke-width:0.7" x="380" y="78" width="40" height="12" rx="3"/>

      <!-- ‚ïê‚ïê‚ïê LABELS ‚ïê‚ïê‚ïê -->
      <text x="175" y="295" text-anchor="middle" class="label" font-size="7" transform="rotate(-90,175,295)">PORT HULL</text>
      <text x="625" y="295" text-anchor="middle" class="label" font-size="7" transform="rotate(90,625,295)">STBD HULL</text>
      <text x="400" y="310" text-anchor="middle" class="label" font-size="7">SALOON</text>
      <text x="400" y="478" text-anchor="middle" class="label" font-size="6">COCKPIT</text>
      <text x="400" y="155" text-anchor="middle" class="label" font-size="6" opacity="0.6">TRAMPOLINE</text>

      <!-- ‚ïê‚ïê‚ïê DIMENSION LINES ‚ïê‚ïê‚ïê -->
      <line x1="90" y1="18" x2="90" y2="655" stroke="rgba(201,168,76,0.18)" stroke-width="0.7"/>
      <line x1="87" y1="18" x2="93" y2="18" stroke="rgba(201,168,76,0.18)" stroke-width="0.7"/>
      <line x1="87" y1="655" x2="93" y2="655" stroke="rgba(201,168,76,0.18)" stroke-width="0.7"/>
      <text x="82" y="340" text-anchor="middle" class="dim-label" font-size="7" transform="rotate(-90,82,340)">LOA 11.73m</text>
      <line x1="110" y1="672" x2="690" y2="672" stroke="rgba(201,168,76,0.18)" stroke-width="0.7"/>
      <text x="400" y="688" text-anchor="middle" class="dim-label" font-size="7">BEAM 6.63m</text>
    </svg>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOTSPOTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         Positions are % of container width/height
    -->

    <!-- BOW / ANCHOR -->
    <div class="hs bad"  style="left:50%;top:10%" id="hs-bow"      onclick="tpop('bow')">BW</div>
    <!-- FORESTAY / RIGGING -->
    <div class="hs ok"   style="left:50%;top:18%" id="hs-rigging"  onclick="tpop('rigging')">RG</div>
    <!-- MAST -->
    <div class="hs ok"   style="left:50%;top:30%" id="hs-mast"     onclick="tpop('mast')">MST</div>
    <!-- SALOON -->
    <div class="hs ok"   style="left:50%;top:43%" id="hs-saloon"   onclick="tpop('saloon')">SLN</div>
    <!-- SOLAR / ELECTRONICS -->
    <div class="hs warn" style="left:42%;top:36%" id="hs-solar"    onclick="tpop('solar')">SOL</div>
    <!-- COCKPIT -->
    <div class="hs warn" style="left:50%;top:67%" id="hs-cockpit"  onclick="tpop('cockpit')">CPT</div>
    <!-- HELM -->
    <div class="hs ok"   style="left:66%;top:76%" id="hs-helm"     onclick="tpop('helm')">HLM</div>
    <!-- TRANSOM / SWIM -->
    <div class="hs ok"   style="left:50%;top:88%" id="hs-transom"  onclick="tpop('transom')">TR</div>

    <!-- PORT HULL sections -->
    <div class="hs ok"   style="left:22%;top:15%" id="hs-p-bow"    onclick="tpop('p-bow')">P-FWD</div>
    <div class="hs ok"   style="left:22%;top:32%" id="hs-p-fwd"    onclick="tpop('p-fwd')">P-CB1</div>
    <div class="hs warn" style="left:22%;top:60%" id="hs-p-aft"    onclick="tpop('p-aft')">P-CB2</div>
    <div class="hs warn" style="left:22%;top:77%" id="hs-p-eng"    onclick="tpop('p-eng')">P-ENG</div>

    <!-- STBD HULL sections -->
    <div class="hs ok"   style="left:78%;top:15%" id="hs-s-bow"    onclick="tpop('s-bow')">S-FWD</div>
    <div class="hs ok"   style="left:78%;top:32%" id="hs-s-fwd"    onclick="tpop('s-fwd')">S-CB1</div>
    <div class="hs ok"   style="left:78%;top:60%" id="hs-s-aft"    onclick="tpop('s-aft')">S-CB2</div>
    <div class="hs bad"  style="left:78%;top:77%" id="hs-s-eng"    onclick="tpop('s-eng')">S-ENG</div>

    <!-- POPUPS (each attached to its hotspot div) -->
    <div id="pp-bow"     style="position:absolute;left:50%;top:10%"><div class="hs-popup" id="ppb-bow"><div class="popup-name">Bow / Windlass</div><div class="popup-status-row"><div class="sdot bad"></div><span>Requires Repair</span></div><select class="popup-select" onchange="updHS('bow',this.value)"><option value="ok">‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad" selected>üî¥ Requires Repair</option></select><input class="popup-note-input" value="Windlass motor faulty ‚Äì repair scheduled"></div></div>

    <div id="pp-rigging" style="position:absolute;left:50%;top:18%"><div class="hs-popup" id="ppb-rigging"><div class="popup-name">Standing Rigging</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('rigging',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-mast"    style="position:absolute;left:50%;top:30%"><div class="hs-popup" id="ppb-mast"><div class="popup-name">Mast & Boom</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('mast',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-saloon"  style="position:absolute;left:50%;top:43%"><div class="hs-popup" id="ppb-saloon"><div class="popup-name">Saloon / Cabin</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('saloon',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-solar"   style="position:absolute;left:42%;top:36%"><div class="hs-popup" id="ppb-solar"><div class="popup-name">Solar / Electronics</div><div class="popup-status-row"><div class="sdot warn"></div><span>Needs Attention</span></div><select class="popup-select" onchange="updHS('solar',this.value)"><option value="ok">‚úÖ Good</option><option value="warn" selected>‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" value="Port solar panel output low"></div></div>

    <div id="pp-cockpit" style="position:absolute;left:50%;top:67%"><div class="hs-popup" id="ppb-cockpit"><div class="popup-name">Cockpit</div><div class="popup-status-row"><div class="sdot warn"></div><span>Needs Attention</span></div><select class="popup-select" onchange="updHS('cockpit',this.value)"><option value="ok">‚úÖ Good</option><option value="warn" selected>‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" value="Teak caulking cracking at port side"></div></div>

    <div id="pp-helm"    style="position:absolute;left:66%;top:76%"><div class="hs-popup" id="ppb-helm"><div class="popup-name">Helm Station</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('helm',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-transom" style="position:absolute;left:50%;top:88%"><div class="hs-popup" id="ppb-transom"><div class="popup-name">Transom / Swim Platform</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('transom',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <!-- PORT HULL popups -->
    <div id="pp-p-bow"   style="position:absolute;left:22%;top:15%"><div class="hs-popup" id="ppb-p-bow"><div class="popup-name">Port ‚Äî Forepeak</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('p-bow',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-p-fwd"   style="position:absolute;left:22%;top:32%"><div class="hs-popup" id="ppb-p-fwd"><div class="popup-name">Port ‚Äî Fwd Cabin</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('p-fwd',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-p-aft"   style="position:absolute;left:22%;top:60%"><div class="hs-popup" id="ppb-p-aft"><div class="popup-name">Port ‚Äî Aft Cabin</div><div class="popup-status-row"><div class="sdot warn"></div><span>Needs Attention</span></div><select class="popup-select" onchange="updHS('p-aft',this.value)"><option value="ok">‚úÖ Good</option><option value="warn" selected>‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" value="Porthole gasket leaking, needs re-seal"></div></div>

    <div id="pp-p-eng"   style="position:absolute;left:22%;top:77%"><div class="hs-popup" id="ppb-p-eng"><div class="popup-name">Port ‚Äî Engine Room</div><div class="popup-status-row"><div class="sdot warn"></div><span>Needs Attention</span></div><select class="popup-select" onchange="updHS('p-eng',this.value)"><option value="ok">‚úÖ Good</option><option value="warn" selected>‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" value="Impeller replacement due 200hr"></div></div>

    <!-- STBD HULL popups -->
    <div id="pp-s-bow"   style="position:absolute;left:78%;top:15%"><div class="hs-popup" id="ppb-s-bow"><div class="popup-name">Stbd ‚Äî Forepeak</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('s-bow',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-s-fwd"   style="position:absolute;left:78%;top:32%"><div class="hs-popup" id="ppb-s-fwd"><div class="popup-name">Stbd ‚Äî Fwd Cabin</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('s-fwd',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-s-aft"   style="position:absolute;left:78%;top:60%"><div class="hs-popup" id="ppb-s-aft"><div class="popup-name">Stbd ‚Äî Aft Cabin</div><div class="popup-status-row"><div class="sdot ok"></div><span>Good Condition</span></div><select class="popup-select" onchange="updHS('s-aft',this.value)"><option value="ok" selected>‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad">üî¥ Requires Repair</option></select><input class="popup-note-input" placeholder="ÂÇôË®ª..."></div></div>

    <div id="pp-s-eng"   style="position:absolute;left:78%;top:77%"><div class="hs-popup" id="ppb-s-eng"><div class="popup-name">Stbd ‚Äî Engine Room</div><div class="popup-status-row"><div class="sdot bad"></div><span>Requires Repair</span></div><select class="popup-select" onchange="updHS('s-eng',this.value)"><option value="ok">‚úÖ Good</option><option value="warn">‚ö†Ô∏è Needs Attention</option><option value="bad" selected>üî¥ Requires Repair</option></select><input class="popup-note-input" value="Heat exchanger cracked ‚Äì parts ordered"></div></div>

  </div><!-- end catWrap -->

  <div class="legend">
    <div class="leg-item"><div class="leg-dot" style="border-color:#27ae60;background:rgba(39,174,96,0.15)"></div>Good</div>
    <div class="leg-item"><div class="leg-dot" style="border-color:var(--amber);background:rgba(214,137,16,0.15)"></div>Needs Attention</div>
    <div class="leg-item"><div class="leg-dot" style="border-color:var(--red);background:rgba(192,57,43,0.15)"></div>Requires Repair</div>
    <div class="leg-item" style="opacity:0.5;font-size:0.58rem">¬∑ PORT = Â∑¶Ëà∑ ¬∑ STBD = Âè≥Ëà∑ ¬∑ FWD = ËàπËâèËâô ¬∑ AFT = ËàπËââËâô ¬∑ ENG = ÂºïÊìéËâô</div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê LOG PANEL ‚ïê‚ïê -->
<div class="panel" id="panel-log">
  <div class="log-controls">
    <button class="btn primary" onclick="openLogModal()">+ Êñ∞Â¢ûË®òÈåÑ</button>
    <select class="filter-select" id="logFilter" onchange="renderLog()">
      <option value="all">ÂÖ®ÈÉ®È°ûÂûã</option>
      <option value="routine">Routine</option><option value="repair">Repair</option>
      <option value="inspect">Inspect</option><option value="upgrade">Upgrade</option>
    </select>
    <select class="filter-select" id="logSystem" onchange="renderLog()">
      <option value="all">ÂÖ®ÈÉ®Á≥ªÁµ±</option>
      <option>Port Hull</option><option>Stbd Hull</option><option>Bridge Deck</option>
      <option>Rigging</option><option>Sails</option><option>Engine Port</option>
      <option>Engine Stbd</option><option>Electrical</option><option>Safety</option>
    </select>
  </div>
  <div class="log-table-wrap">
    <table><thead><tr>
      <th>Date</th><th>System</th><th>Type</th><th>Task</th>
      <th>By</th><th>Cost (TWD)</th><th>Next Due</th><th>Engine Hr</th><th>Notes</th><th></th>
    </tr></thead><tbody id="logBody"></tbody></table>
  </div>
</div>

<!-- ‚ïê‚ïê BOM PANEL ‚ïê‚ïê -->
<div class="panel" id="panel-bom">
  <div class="bom-stats" id="bomStats"></div>
  <div class="bom-controls">
    <button class="btn primary" onclick="openBomModal()">+ Êñ∞Â¢ûÈõ∂‰ª∂</button>
    <input class="search-input" id="bomSearch" placeholder="ÊêúÂ∞ãÈõ∂‰ª∂ÂêçÁ®± / ÊñôËôü..." oninput="renderBom()">
    <select class="filter-select" id="bomFilter" onchange="renderBom()">
      <option value="all">ÂÖ®ÈÉ®ÂàÜÈ°û</option>
      <option>Hull</option><option>Rigging</option><option>Sails</option>
      <option>Engine</option><option>Electrical</option><option>Deck Hardware</option>
      <option>Safety</option><option>Navigation</option>
    </select>
  </div>
  <div class="log-table-wrap">
    <table><thead><tr>
      <th>#</th><th>Part Name</th><th>Category</th><th>Part No.</th><th>Maker</th>
      <th>Qty</th><th>Unit</th><th>Unit Cost</th><th>Stock</th><th>Reorder At</th>
      <th>Supplier</th><th>Notes</th><th></th>
    </tr></thead><tbody id="bomBody"></tbody></table>
  </div>
</div>

<!-- ‚ïê‚ïê SCHEDULE PANEL ‚ïê‚ïê -->
<div class="panel" id="panel-schedule">

  <!-- Current Engine Hours -->
  <div class="hours-overview">
    <div class="hours-card">
      <label>Port Engine</label>
      <input type="number" id="hrPortEng" placeholder="0" min="0" onchange="updSchHours('port',this.value)">
      <div class="hrs-unit">HRS</div>
    </div>
    <div class="hours-card">
      <label>Stbd Engine</label>
      <input type="number" id="hrStbdEng" placeholder="0" min="0" onchange="updSchHours('stbd',this.value)">
      <div class="hrs-unit">HRS</div>
    </div>
    <div class="hours-card">
      <label>Generator</label>
      <input type="number" id="hrGen" placeholder="0" min="0" onchange="updSchHours('gen',this.value)">
      <div class="hrs-unit">HRS</div>
    </div>
  </div>

  <!-- Summary badges -->
  <div id="schSummary"></div>

  <!-- Port Engine -->
  <div class="sch-section">
    <div class="sch-section-title">üîß Â∑¶Ëà∑‰∏ªÊ©ü‰øùÈ§äÊôÇÁ®ã ‚Äî Volvo Penta (Port)</div>
    <div id="schPortEngList"></div>
  </div>

  <!-- Starboard Engine -->
  <div class="sch-section">
    <div class="sch-section-title">üîß Âè≥Ëà∑‰∏ªÊ©ü‰øùÈ§äÊôÇÁ®ã ‚Äî Volvo Penta (Stbd)</div>
    <div id="schStbdEngList"></div>
  </div>

  <!-- Generator -->
  <div class="sch-section">
    <div class="sch-section-title">‚ö° ÁôºÈõªÊ©ü‰øùÈ§äÊôÇÁ®ã ‚Äî WhisperPower</div>
    <div id="schGenList"></div>
  </div>

</div>

<!-- LOG MODAL -->
<div class="modal-overlay" id="logModal">
  <div class="modal">
    <h3>üìã Êñ∞Â¢ûÁ∂≠Ë≠∑Ë®òÈåÑ</h3>
    <div class="form-grid">
      <div class="form-group"><label>Date</label><input type="date" id="lDate"></div>
      <div class="form-group"><label>System</label>
        <select id="lSystem"><option>Port Hull</option><option>Stbd Hull</option><option>Bridge Deck</option><option>Rigging</option><option>Sails</option><option>Engine Port</option><option>Engine Stbd</option><option>Electrical</option><option>Safety</option></select>
      </div>
      <div class="form-group"><label>Type</label>
        <select id="lType"><option value="routine">Routine</option><option value="repair">Repair</option><option value="inspect">Inspect</option><option value="upgrade">Upgrade</option></select>
      </div>
      <div class="form-group"><label>Performed By</label><input type="text" id="lBy" placeholder="Owner / Yard"></div>
      <div class="form-group full"><label>Task Description</label><input type="text" id="lTask" placeholder="Describe the task..."></div>
      <div class="form-group"><label>Cost (TWD)</label><input type="number" id="lCost" placeholder="0"></div>
      <div class="form-group"><label>Next Due</label><input type="date" id="lNext"></div>
      <div class="form-group"><label>Engine Hr</label><input type="number" id="lEngineHr" placeholder="e.g. 1250"></div>
      <div class="form-group full"><label>Notes</label><textarea id="lNotes"></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('logModal')">ÂèñÊ∂à</button>
      <button class="btn primary" onclick="saveLog()">ÂÑ≤Â≠òË®òÈåÑ</button>
    </div>
  </div>
</div>

<!-- BOM MODAL -->
<div class="modal-overlay" id="bomModal">
  <div class="modal">
    <h3>üî© Êñ∞Â¢ûÈõ∂‰ª∂</h3>
    <div class="form-grid">
      <div class="form-group full"><label>Part Name</label><input type="text" id="bName"></div>
      <div class="form-group"><label>Category</label><select id="bCat"><option>Hull</option><option>Rigging</option><option>Sails</option><option>Engine</option><option>Electrical</option><option>Deck Hardware</option><option>Safety</option><option>Navigation</option></select></div>
      <div class="form-group"><label>Part No.</label><input type="text" id="bPartNo"></div>
      <div class="form-group"><label>Maker</label><input type="text" id="bMaker"></div>
      <div class="form-group"><label>Qty</label><input type="number" id="bQty" value="1"></div>
      <div class="form-group"><label>Unit</label><select id="bUnit"><option>pc</option><option>set</option><option>m</option><option>L</option><option>kg</option><option>box</option></select></div>
      <div class="form-group"><label>Unit Cost (TWD)</label><input type="number" id="bCost" placeholder="0"></div>
      <div class="form-group"><label>Stock</label><input type="number" id="bStock" placeholder="0"></div>
      <div class="form-group"><label>Reorder At</label><input type="number" id="bReorder" placeholder="1"></div>
      <div class="form-group full"><label>Supplier</label><input type="text" id="bSupplier"></div>
      <div class="form-group full"><label>Notes</label><textarea id="bNotes"></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('bomModal')">ÂèñÊ∂à</button>
      <button class="btn primary" onclick="saveBom()">ÂÑ≤Â≠òÈõ∂‰ª∂</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOCAL STORAGE KEYS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LS = {
  log:      'lucia40_log',
  bom:      'lucia40_bom',
  hotspots: 'lucia40_hotspots',
  vessel:   'lucia40_vessel',
};

// ‚îÄ‚îÄ DEFAULT DATA ‚îÄ‚îÄ
const DEFAULT_LOG = [
  {date:'2025-01-15',system:'Engine Port',type:'routine',task:'Engine oil & filter change',by:'Owner',cost:2800,next:'2025-07-15',engineHr:'1250',notes:'Yanmar 15W-40'},
  {date:'2025-01-20',system:'Rigging',type:'inspect',task:'Standing rigging inspection',by:'Offshore Rigging Co.',cost:3500,next:'2026-01-20',engineHr:'',notes:'Forestay pin replaced'},
  {date:'2025-02-05',system:'Port Hull',type:'routine',task:'Antifouling paint ‚Äì full haul-out',by:'Marina Yard',cost:28000,next:'2026-02-05',engineHr:'',notes:'Both hulls ‚Äì Coppercoat + 2 top coats'},
  {date:'2025-02-10',system:'Sails',type:'inspect',task:'Sail inspection & UV cover',by:'Island Sails',cost:4500,next:'2026-02-10',engineHr:'',notes:'Jib UV strip worn'},
  {date:'2024-11-30',system:'Electrical',type:'repair',task:'Navigation lights rewire',by:'Marine Electrician',cost:6200,next:'2025-11-30',engineHr:'',notes:'NMEA connections re-made with tinned wire'},
  {date:'2025-02-18',system:'Engine Stbd',type:'repair',task:'Heat exchanger replacement',by:'Diesel Marine TW',cost:18500,next:'2026-02-18',engineHr:'1380',notes:'Cracked core replaced, parts on order'},
];
const DEFAULT_BOM = [
  {name:'Engine Impeller',cat:'Engine',partNo:'3587911',maker:'Volvo Penta',qty:2,unit:'pc',cost:850,stock:1,reorder:1,supplier:'Volvo Marine TW',notes:'Replace every 200 hrs ‚Äì both engines'},
  {name:'Engine Oil 15W-40',cat:'Engine',partNo:'YM-OIL15W',maker:'Yanmar',qty:4,unit:'L',cost:320,stock:4,reorder:4,supplier:'Yanmar Taiwan',notes:''},
  {name:'Oil Filter',cat:'Engine',partNo:'129150-35170',maker:'Yanmar',qty:2,unit:'pc',cost:480,stock:2,reorder:1,supplier:'Yanmar Taiwan',notes:'One per engine'},
  {name:'Jib UV Strip',cat:'Sails',partNo:'UV-STRIP-38',maker:'Island Sails',qty:1,unit:'set',cost:3800,stock:0,reorder:1,supplier:'Island Sails Kaohsiung',notes:'Sunbrella fabric'},
  {name:'Winch Grease',cat:'Deck Hardware',partNo:'WG-100',maker:'Lewmar',qty:1,unit:'pc',cost:420,stock:2,reorder:1,supplier:'Lewmar distributor',notes:''},
  {name:'Main Sheet 12mm',cat:'Rigging',partNo:'RS-12MM-20M',maker:'Marlow',qty:1,unit:'m',cost:180,stock:20,reorder:5,supplier:'Marlow Ropes',notes:'20m'},
  {name:'Flare Kit',cat:'Safety',partNo:'FK-2025',maker:'Pains Wessex',qty:1,unit:'set',cost:2200,stock:1,reorder:1,supplier:'Safety Marine TW',notes:'Expires 2027-06'},
  {name:'Porthole Gasket 200mm',cat:'Hull',partNo:'PG-200',maker:'Lewmar',qty:4,unit:'pc',cost:380,stock:2,reorder:2,supplier:'Chandlery Marine',notes:'Port aft cabin ‚Äì 2 needed'},
];
const DEFAULT_HOTSPOTS = {
  'bow':'bad','rigging':'ok','mast':'ok','saloon':'ok','solar':'warn',
  'cockpit':'warn','helm':'ok','transom':'ok',
  'p-bow':'ok','p-fwd':'ok','p-aft':'warn','p-eng':'warn',
  's-bow':'ok','s-fwd':'ok','s-aft':'ok','s-eng':'bad',
};

// ‚îÄ‚îÄ LOAD / SAVE HELPERS ‚îÄ‚îÄ
function lsGet(key, fallback){
  try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
  catch(e){ return fallback; }
}
function lsSet(key, val){
  try { localStorage.setItem(key, JSON.stringify(val)); } catch(e){}
}

// ‚îÄ‚îÄ LIVE DATA ‚îÄ‚îÄ
let logData      = lsGet(LS.log,      DEFAULT_LOG);
let bomData      = lsGet(LS.bom,      DEFAULT_BOM);
let hsStates     = lsGet(LS.hotspots, DEFAULT_HOTSPOTS);
let vesselFields = lsGet(LS.vessel,   {name:'S/V Sea Wanderer', hull:'', year:'2018'});

// ‚îÄ‚îÄ SAVE INDICATOR ‚îÄ‚îÄ
function flashSaved(){
  const el = document.getElementById('saveIndicator');
  if(!el) return;
  el.style.opacity = '1';
  clearTimeout(el._t);
  el._t = setTimeout(()=>{ el.style.opacity='0'; }, 1800);
}

// ‚îÄ‚îÄ VESSEL FIELDS PERSISTENCE ‚îÄ‚îÄ
function initVesselFields(){
  const vn = document.querySelector('input[placeholder="S/V My Boat"], input[value="S/V Sea Wanderer"]');
  // Bind all vessel inputs
  document.querySelectorAll('header input').forEach(inp => {
    inp.addEventListener('change', ()=>{
      const inputs = [...document.querySelectorAll('header input')];
      vesselFields = {
        name: inputs[0]?.value||'',
        hull: inputs[1]?.value||'',
        year: inputs[2]?.value||'',
      };
      lsSet(LS.vessel, vesselFields);
      flashSaved();
    });
  });
  // Restore
  const inputs = [...document.querySelectorAll('header input')];
  if(inputs[0]) inputs[0].value = vesselFields.name || '';
  if(inputs[1]) inputs[1].value = vesselFields.hull || '';
  if(inputs[2]) inputs[2].value = vesselFields.year || '';
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ
function switchTab(n){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+n).classList.add('active');
  const m={diagram:0,log:1,bom:2,schedule:3};
  document.querySelectorAll('.tab')[m[n]].classList.add('active');
  if(n==='log') renderLog();
  if(n==='bom') renderBom();
  if(n==='schedule') renderSchedule();
}

// ‚îÄ‚îÄ HOTSPOT POPUPS ‚îÄ‚îÄ
let activePP = null;

function initHotspots(){
  // Restore saved states
  Object.entries(hsStates).forEach(([id, val])=>{
    const hs = document.getElementById('hs-'+id);
    if(hs){ hs.className = 'hs '+val; }
    const dot = document.querySelector('#ppb-'+id+' .sdot');
    if(dot){ dot.className = 'sdot '+val; }
    const sel = document.querySelector('#ppb-'+id+' .popup-select');
    if(sel){ sel.value = val; }
    const lbl = document.querySelector('#ppb-'+id+' .popup-status-row span');
    const map={ok:'Good Condition',warn:'Needs Attention',bad:'Requires Repair'};
    if(lbl) lbl.textContent = map[val];
  });
  // Restore notes
  const notes = lsGet('lucia40_hs_notes', {});
  Object.entries(notes).forEach(([id, txt])=>{
    const inp = document.querySelector('#ppb-'+id+' .popup-note-input');
    if(inp) inp.value = txt;
  });
  // Bind note inputs
  document.querySelectorAll('.popup-note-input').forEach(inp=>{
    const ppb = inp.closest('[id^="ppb-"]');
    if(!ppb) return;
    const id = ppb.id.replace('ppb-','');
    inp.addEventListener('input', ()=>{
      const allNotes = lsGet('lucia40_hs_notes', {});
      allNotes[id] = inp.value;
      lsSet('lucia40_hs_notes', allNotes);
      flashSaved();
    });
  });
}

function tpop(id){
  const box = document.getElementById('ppb-'+id);
  if(!box) return;
  if(activePP && activePP !== box){ activePP.classList.remove('show'); }
  box.classList.toggle('show');
  activePP = box.classList.contains('show') ? box : null;
}

function updHS(id, val){
  const hs = document.getElementById('hs-'+id);
  hs.className = 'hs '+val;
  const dot = document.querySelector('#ppb-'+id+' .sdot');
  if(dot){ dot.className='sdot '+val; }
  const lbl = document.querySelector('#ppb-'+id+' .popup-status-row span');
  const map={ok:'Good Condition',warn:'Needs Attention',bad:'Requires Repair'};
  if(lbl) lbl.textContent = map[val];
  hsStates[id] = val;
  lsSet(LS.hotspots, hsStates);
  flashSaved();
}

document.addEventListener('click', e=>{
  if(activePP && !e.target.closest('.hs') && !e.target.closest('.hs-popup')){
    activePP.classList.remove('show'); activePP=null;
  }
});

// ‚îÄ‚îÄ LOG ‚îÄ‚îÄ
function renderLog(){
  const ft = document.getElementById('logFilter').value;
  const fs = document.getElementById('logSystem').value;
  const rows = logData.filter(r=>(ft==='all'||r.type===ft)&&(fs==='all'||r.system===fs));
  document.getElementById('logBody').innerHTML = rows.map(r=>{
    const i=logData.indexOf(r);
    return `<tr>
      <td data-label="DATE" contenteditable="true" onblur="updLog(${i},'date',this.textContent)">${r.date}</td>
      <td data-label="SYSTEM" contenteditable="true" onblur="updLog(${i},'system',this.textContent)">${r.system}</td>
      <td data-label="TYPE"><span class="badge ${r.type}">${r.type}</span></td>
      <td data-label="TASK" contenteditable="true" onblur="updLog(${i},'task',this.textContent)">${r.task}</td>
      <td data-label="BY" contenteditable="true" onblur="updLog(${i},'by',this.textContent)">${r.by}</td>
      <td data-label="COST (TWD)" contenteditable="true" onblur="updLog(${i},'cost',this.textContent)">${r.cost.toLocaleString()}</td>
      <td data-label="NEXT DUE" contenteditable="true" onblur="updLog(${i},'next',this.textContent)">${r.next||'‚Äî'}</td>
      <td data-label="ENGINE HR" contenteditable="true" onblur="updLog(${i},'engineHr',this.textContent)">${r.engineHr||'‚Äî'}</td>
      <td data-label="NOTES" contenteditable="true" onblur="updLog(${i},'notes',this.textContent)" style="font-size:0.8rem;opacity:0.7">${r.notes||''}</td>
      <td data-label=""><button class="del-btn" onclick="delLog(${i})">‚úï</button></td>
    </tr>`;
  }).join('');
}
function updLog(i,k,v){
  logData[i][k]=k==='cost'?Number(v.replace(/,/g,''))||0:v;
  lsSet(LS.log, logData);
  flashSaved();
}
function delLog(i){ if(confirm('Âà™Èô§ÈÄôÁ≠ÜË®òÈåÑÔºü')){ logData.splice(i,1); lsSet(LS.log,logData); renderLog(); } }
function openLogModal(){ document.getElementById('lDate').value=new Date().toISOString().split('T')[0]; document.getElementById('logModal').classList.add('show'); }
function saveLog(){
  const r={
    date:document.getElementById('lDate').value,
    system:document.getElementById('lSystem').value,
    type:document.getElementById('lType').value,
    task:document.getElementById('lTask').value,
    by:document.getElementById('lBy').value,
    cost:Number(document.getElementById('lCost').value)||0,
    next:document.getElementById('lNext').value,
    engineHr:document.getElementById('lEngineHr').value,
    notes:document.getElementById('lNotes').value
  };
  if(!r.task){alert('Ë´ãËº∏ÂÖ•Á∂≠Ë≠∑È†ÖÁõÆ');return;}
  logData.unshift(r);
  lsSet(LS.log, logData);
  flashSaved();
  closeModal('logModal');
  renderLog();
}

// ‚îÄ‚îÄ BOM ‚îÄ‚îÄ
function renderBom(){
  const s=document.getElementById('bomSearch').value.toLowerCase();
  const f=document.getElementById('bomFilter').value;
  const rows=bomData.filter(r=>(f==='all'||r.cat===f)&&(r.name.toLowerCase().includes(s)||r.partNo.toLowerCase().includes(s)||r.maker.toLowerCase().includes(s)));
  const tv=bomData.reduce((a,r)=>a+r.cost*r.qty,0);
  const lo=bomData.filter(r=>r.stock<=r.reorder).length;
  document.getElementById('bomStats').innerHTML=`
    <div class="stat-card"><div class="stat-label">Total Parts</div><div class="stat-value">${bomData.length}</div><div class="stat-sub">unique items</div></div>
    <div class="stat-card"><div class="stat-label">Inventory Value</div><div class="stat-value">$${tv.toLocaleString()}</div><div class="stat-sub">TWD</div></div>
    <div class="stat-card"><div class="stat-label">Low Stock / Reorder</div><div class="stat-value" style="color:${lo>0?'var(--amber)':'#27ae60'}">${lo}</div><div class="stat-sub">items</div></div>`;
  document.getElementById('bomBody').innerHTML=rows.map(r=>{
    const i=bomData.indexOf(r), low=r.stock<=r.reorder;
    return `<tr>
      <td data-label="#" style="opacity:0.35;font-family:'JetBrains Mono',monospace;font-size:0.68rem">${i+1}</td>
      <td data-label="PART NAME" contenteditable="true" onblur="updBom(${i},'name',this.textContent)" style="font-weight:500">${r.name}</td>
      <td data-label="CATEGORY"><span class="badge routine" style="font-size:0.56rem">${r.cat}</span></td>
      <td data-label="PART NO." contenteditable="true" onblur="updBom(${i},'partNo',this.textContent)" style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;opacity:0.65">${r.partNo}</td>
      <td data-label="MAKER" contenteditable="true" onblur="updBom(${i},'maker',this.textContent)">${r.maker}</td>
      <td data-label="QTY" contenteditable="true" onblur="updBom(${i},'qty',this.textContent)" style="text-align:center">${r.qty}</td>
      <td data-label="UNIT" style="opacity:0.55;font-size:0.78rem">${r.unit}</td>
      <td data-label="UNIT COST" contenteditable="true" onblur="updBom(${i},'cost',this.textContent)">$${r.cost.toLocaleString()}</td>
      <td data-label="STOCK" contenteditable="true" onblur="updBom(${i},'stock',this.textContent)" style="color:${low?'var(--amber)':'inherit'};font-weight:${low?600:400}">${r.stock}${low?' ‚ö†Ô∏è':''}</td>
      <td data-label="REORDER AT" contenteditable="true" onblur="updBom(${i},'reorder',this.textContent)">${r.reorder}</td>
      <td data-label="SUPPLIER" contenteditable="true" onblur="updBom(${i},'supplier',this.textContent)" style="font-size:0.78rem;opacity:0.7">${r.supplier}</td>
      <td data-label="NOTES" contenteditable="true" onblur="updBom(${i},'notes',this.textContent)" style="font-size:0.75rem;opacity:0.55">${r.notes}</td>
      <td data-label=""><button class="del-btn" onclick="delBom(${i})">‚úï</button></td>
    </tr>`;
  }).join('');
}
function updBom(i,k,v){
  bomData[i][k]=['qty','cost','stock','reorder'].includes(k)?Number(v.replace(/[$,‚ö†Ô∏è\s]/g,''))||0:v;
  lsSet(LS.bom, bomData);
  flashSaved();
}
function delBom(i){ if(confirm('Âà™Èô§ÈÄôÁ≠ÜÈõ∂‰ª∂Ôºü')){ bomData.splice(i,1); lsSet(LS.bom,bomData); renderBom(); } }
function openBomModal(){ document.getElementById('bomModal').classList.add('show'); }
function saveBom(){
  const r={
    name:document.getElementById('bName').value,
    cat:document.getElementById('bCat').value,
    partNo:document.getElementById('bPartNo').value,
    maker:document.getElementById('bMaker').value,
    qty:Number(document.getElementById('bQty').value)||1,
    unit:document.getElementById('bUnit').value,
    cost:Number(document.getElementById('bCost').value)||0,
    stock:Number(document.getElementById('bStock').value)||0,
    reorder:Number(document.getElementById('bReorder').value)||1,
    supplier:document.getElementById('bSupplier').value,
    notes:document.getElementById('bNotes').value
  };
  if(!r.name){alert('Ë´ãËº∏ÂÖ•Èõ∂‰ª∂ÂêçÁ®±');return;}
  bomData.push(r);
  lsSet(LS.bom, bomData);
  flashSaved();
  closeModal('bomModal');
  renderBom();
}

// ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ
function closeModal(id){ document.getElementById(id).classList.remove('show'); }
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show');}));

// ‚îÄ‚îÄ BACKUP: Export all data as JSON file ‚îÄ‚îÄ
function exportBackup(){
  const data = {
    exportedAt: new Date().toISOString(),
    vessel: lsGet(LS.vessel,{}),
    log: logData,
    bom: bomData,
    hotspots: hsStates,
    notes: lsGet('lucia40_hs_notes',{}),
    schedule: scheduleData,
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'lucia40-backup-'+new Date().toISOString().slice(0,10)+'.json';
  a.click();
  URL.revokeObjectURL(url);
}

// ‚îÄ‚îÄ RESTORE: Import JSON backup ‚îÄ‚îÄ
function importBackup(){
  const inp = document.createElement('input');
  inp.type = 'file'; inp.accept = '.json';
  inp.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ev=>{
      try{
        const data = JSON.parse(ev.target.result);
        if(data.log)      { logData=data.log;         lsSet(LS.log, logData); }
        if(data.bom)      { bomData=data.bom;          lsSet(LS.bom, bomData); }
        if(data.hotspots) { hsStates=data.hotspots;    lsSet(LS.hotspots, hsStates); }
        if(data.vessel)   { lsSet(LS.vessel, data.vessel); }
        if(data.notes)    { lsSet('lucia40_hs_notes', data.notes); }
        if(data.schedule) { scheduleData=data.schedule; lsSet(LS_SCH, scheduleData); }
        alert('‚úÖ ÂÇô‰ªΩÈÇÑÂéüÊàêÂäüÔºÅ');
        location.reload();
      } catch(err){ alert('‚ùå ÁÑ°ÊïàÁöÑÂÇô‰ªΩÊ™îÊ°à'); }
    };
    reader.readAsText(file);
  };
  inp.click();
}

// ‚îÄ‚îÄ RESET to defaults ‚îÄ‚îÄ
function resetAll(){
  if(!confirm('‚ö†Ô∏è Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâË≥áÊñô‰∏¶ÊÅ¢Âæ©È†êË®≠ÂÄºÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) return;
  Object.values(LS).forEach(k=>localStorage.removeItem(k));
  localStorage.removeItem('lucia40_hs_notes');
  localStorage.removeItem(LS_SCH);
  location.reload();
}

// ‚îÄ‚îÄ SCHEDULE ‚îÄ‚îÄ
const LS_SCH = 'lucia40_schedule';

const SCH_ITEMS_ENGINE = [
  {id:'e01', task:'Ê©üÊ≤πÂèäÊ©üÊ≤πÊøæÊ∏ÖÂô®Êõ¥Êèõ',   subTask:'Engine oil & oil filter',        intervalHr:200, intervalMo:12},
  {id:'e02', task:'ÂàùÁ¥öÁáÉÊ≤πÊøæÊ∏ÖÂô®Êõ¥Êèõ',     subTask:'Primary fuel filter',             intervalHr:200, intervalMo:12},
  {id:'e03', task:'Ê¨°Á¥öÁáÉÊ≤πÊøæÊ∏ÖÂô®Êõ¥Êèõ',     subTask:'Secondary fuel filter',           intervalHr:500, intervalMo:24},
  {id:'e04', task:'Êµ∑Ê∞¥Ê≥µËëâËº™Êõ¥Êèõ',         subTask:'Raw water pump impeller',         intervalHr:200, intervalMo:12},
  {id:'e05', task:'ÂÜ∑ÂçªÊ∂≤Ê∂≤‰ΩçÂèäÁãÄÊÖãÊ™¢Êü•',   subTask:'Coolant level & condition check', intervalHr:200, intervalMo:12},
  {id:'e06', task:'Ê∑°Ê∞¥ÂÜ∑ÂçªÊ∂≤Êõ¥Êèõ',         subTask:'Fresh water coolant change',      intervalHr:null, intervalMo:60},
  {id:'e07', task:'ÂÇ≥ÂãïÁöÆÂ∏∂Ê™¢Êü•',           subTask:'Drive belt inspection',           intervalHr:200, intervalMo:12},
  {id:'e08', task:'ÂÇ≥ÂãïÁöÆÂ∏∂Êõ¥Êèõ',           subTask:'Drive belt replacement',          intervalHr:500, intervalMo:24},
  {id:'e09', task:'ÂÖÖÈõªÁôºÈõªÊ©üÁöÆÂ∏∂Êõ¥Êèõ',     subTask:'Alternator belt replacement',     intervalHr:200, intervalMo:12},
  {id:'e10', task:'ÁÜ±‰∫§ÊèõÂô®Ê∏ÖÊ¥ó',           subTask:'Heat exchanger service',          intervalHr:500, intervalMo:24},
  {id:'e11', task:'Ê∞£ÈñÄÈñìÈöôÊ™¢Êü•Ë™øÊï¥',       subTask:'Valve clearance check',           intervalHr:500, intervalMo:24},
  {id:'e12', task:'Âô¥Ê≤πÂò¥‰øùÈ§ä',             subTask:'Injector service',                intervalHr:500, intervalMo:24},
  {id:'e13', task:'Ê∏¶Ëº™Â¢ûÂ£ìÂô®Ê™¢Êü•',         subTask:'Turbocharger inspection',         intervalHr:500, intervalMo:24},
  {id:'e14', task:'ÈΩíËº™ÁÆ±Ê©üÊ≤πÊõ¥Êèõ',         subTask:'Transmission oil change',         intervalHr:500, intervalMo:24},
  {id:'e15', task:'ÂºïÊìéÊû∂Ê™¢Êü•',             subTask:'Engine mounts inspection',        intervalHr:null, intervalMo:12},
  {id:'e16', task:'ÊéíÊ∞£Á≥ªÁµ±Ê™¢Êü•',           subTask:'Exhaust system inspection',       intervalHr:null, intervalMo:12},
  {id:'e17', task:'Èò≤ËÖêÈãÖÂ°äÊõ¥Êèõ',           subTask:'Zinc anodes replacement',         intervalHr:null, intervalMo:12},
];

const SCH_ITEMS_GEN = [
  {id:'g01', task:'Ê©üÊ≤πÂèäÊ©üÊ≤πÊøæÊ∏ÖÂô®Êõ¥Êèõ', subTask:'Engine oil & oil filter',     intervalHr:200,  intervalMo:12},
  {id:'g02', task:'ÁáÉÊ≤πÊøæÊ∏ÖÂô®Êõ¥Êèõ',       subTask:'Fuel filter replacement',     intervalHr:200,  intervalMo:12},
  {id:'g03', task:'Êµ∑Ê∞¥Ê≥µËëâËº™Êõ¥Êèõ',       subTask:'Raw water pump impeller',     intervalHr:200,  intervalMo:12},
  {id:'g04', task:'ÂÜ∑ÂçªÊ∂≤Ê∂≤‰ΩçÊ™¢Êü•',       subTask:'Coolant level check',         intervalHr:null, intervalMo:6},
  {id:'g05', task:'ÂÜ∑ÂçªÊ∂≤Êõ¥Êèõ',           subTask:'Coolant change',              intervalHr:null, intervalMo:24},
  {id:'g06', task:'Á©∫Ê∞£ÊøæÊ∏ÖÂô®‰øùÈ§ä',       subTask:'Air filter service',          intervalHr:400,  intervalMo:12},
  {id:'g07', task:'ÂÇ≥ÂãïÁöÆÂ∏∂Êõ¥Êèõ',         subTask:'Drive belt replacement',      intervalHr:400,  intervalMo:24},
  {id:'g08', task:'ÁÜ±‰∫§ÊèõÂô®Ê∏ÖÊ¥ó',         subTask:'Heat exchanger service',      intervalHr:800,  intervalMo:24},
  {id:'g09', task:'Ê∞£ÈñÄÈñìÈöôÊ™¢Êü•Ë™øÊï¥',     subTask:'Valve clearance check',       intervalHr:800,  intervalMo:24},
  {id:'g10', task:'ÈõªÊ±†ËàáÂïüÂãïÂô®Ê™¢Êü•',     subTask:'Battery & starter check',     intervalHr:null, intervalMo:12},
];

// Derive port (p-) and stbd (s-) engine item lists from the same template
const SCH_ITEMS_PORT = SCH_ITEMS_ENGINE.map(item => ({...item, id:'p'+item.id}));
const SCH_ITEMS_STBD = SCH_ITEMS_ENGINE.map(item => ({...item, id:'s'+item.id}));

let scheduleData = lsGet(LS_SCH, {hr:{port:0,stbd:0,gen:0}, items:{}});

function updSchHours(which, val){
  scheduleData.hr[which] = parseFloat(val)||0;
  lsSet(LS_SCH, scheduleData);
  renderSchedule();
  flashSaved();
}

function updSchItem(id, field, val){
  if(!scheduleData.items[id]) scheduleData.items[id] = {};
  scheduleData.items[id][field] = val;
  lsSet(LS_SCH, scheduleData);
  renderSchedule();
  flashSaved();
}

function _schStatus(item, currentHr){
  const rec = scheduleData.items[item.id] || {};
  let hrStatus = 'neutral', moStatus = 'neutral';

  if(item.intervalHr && currentHr > 0){
    const lastHr  = parseFloat(rec.lastHr)||0;
    const nextHr  = lastHr + item.intervalHr;
    const rem     = nextHr - currentHr;
    const warnAt  = item.intervalHr * 0.15;
    if(rem <= 0)       hrStatus = 'bad';
    else if(rem <= warnAt) hrStatus = 'warn';
    else               hrStatus = 'ok';
  }

  if(item.intervalMo && rec.lastDate){
    const nextDate = new Date(rec.lastDate);
    nextDate.setMonth(nextDate.getMonth() + item.intervalMo);
    const daysRem  = Math.ceil((nextDate - new Date())/(1000*60*60*24));
    const warnDays = Math.ceil(item.intervalMo * 30 * 0.15);
    if(daysRem <= 0)         moStatus = 'bad';
    else if(daysRem <= warnDays) moStatus = 'warn';
    else                     moStatus = 'ok';
  }

  if(hrStatus==='bad'  || moStatus==='bad')  return 'bad';
  if(hrStatus==='warn' || moStatus==='warn') return 'warn';
  if(hrStatus==='ok'   || moStatus==='ok')   return 'ok';
  return 'neutral';
}

function _renderSchItems(items, currentHr){
  return items.map(item=>{
    const rec    = scheduleData.items[item.id] || {};
    const status = _schStatus(item, currentHr);
    const sLabel = {ok:'‚úì ÁãÄÊÖãÊ≠£Â∏∏', warn:'‚ö† Âç≥Â∞áÂà∞Êúü', bad:'‚úï Â∑≤ÈÄæÊúü', neutral:'‚Äî Â∞öÊú™Ë®òÈåÑ'}[status];
    const itvTxt = [
      item.intervalHr ? `ÊØè ${item.intervalHr} hr` : '',
      item.intervalMo ? `ÊØè ${item.intervalMo} ÂÄãÊúà` : ''
    ].filter(Boolean).join(' ¬∑ ');
    return `<div class="sch-item ${status}">
  <div class="sch-task">${item.task}</div>
  <div class="sch-interval">${item.subTask} &nbsp;¬∑&nbsp; ${itvTxt}</div>
  <div class="sch-inputs">
    <div class="sch-input-group">
      <label>‰∏äÊ¨°‰øùÈ§äÊôÇÊï∏</label>
      <input type="number" placeholder="e.g. 1450" value="${rec.lastHr||''}" onchange="updSchItem('${item.id}','lastHr',this.value)">
    </div>
    <div class="sch-input-group">
      <label>‰∏äÊ¨°‰øùÈ§äÊó•Êúü</label>
      <input type="date" value="${rec.lastDate||''}" onchange="updSchItem('${item.id}','lastDate',this.value)">
    </div>
  </div>
  <div class="sch-status ${status}">${sLabel}</div>
</div>`;
  }).join('');
}

function _renderSchSummary(){
  const hr = scheduleData.hr;
  const counts = {ok:0, warn:0, bad:0, neutral:0};
  SCH_ITEMS_PORT.forEach(item => counts[_schStatus(item, hr.port||0)]++);
  SCH_ITEMS_STBD.forEach(item => counts[_schStatus(item, hr.stbd||0)]++);
  SCH_ITEMS_GEN.forEach(item  => counts[_schStatus(item, hr.gen||0)]++);
  return `<div class="sch-summary">
  <span class="sch-badge ok">‚úì ${counts.ok} È†ÖÊ≠£Â∏∏</span>
  <span class="sch-badge warn">‚ö† ${counts.warn} È†ÖÂç≥Â∞áÂà∞Êúü</span>
  <span class="sch-badge bad">‚úï ${counts.bad} È†ÖÂ∑≤ÈÄæÊúü</span>
  <span class="sch-badge neutral">‚Äî ${counts.neutral} È†ÖÊú™Ë®òÈåÑ</span>
</div>`;
}

function renderSchedule(){
  const hr = scheduleData.hr;
  const portEl = document.getElementById('hrPortEng');
  const stbdEl = document.getElementById('hrStbdEng');
  const genEl  = document.getElementById('hrGen');
  if(portEl && !portEl.matches(':focus')) portEl.value = hr.port||'';
  if(stbdEl && !stbdEl.matches(':focus')) stbdEl.value = hr.stbd||'';
  if(genEl  && !genEl.matches(':focus'))  genEl.value  = hr.gen||'';
  document.getElementById('schSummary').innerHTML     = _renderSchSummary();
  document.getElementById('schPortEngList').innerHTML = _renderSchItems(SCH_ITEMS_PORT, hr.port||0);
  document.getElementById('schStbdEngList').innerHTML = _renderSchItems(SCH_ITEMS_STBD, hr.stbd||0);
  document.getElementById('schGenList').innerHTML     = _renderSchItems(SCH_ITEMS_GEN, hr.gen||0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
initVesselFields();
initHotspots();
renderLog();
</script>

<!-- Save indicator + backup toolbar -->
<style>
#saveIndicator {
  position: fixed; bottom: 1.2rem; right: 1.2rem;
  background: rgba(39,174,96,0.9); color: #fff;
  font-family: 'JetBrains Mono', monospace; font-size: 0.65rem;
  letter-spacing: 0.1em; padding: 0.4rem 0.9rem;
  border-radius: 20px; opacity: 0;
  transition: opacity 0.3s; z-index: 200;
  pointer-events: none;
}
#backupBar {
  position: fixed; bottom: 1.2rem; left: 1.2rem;
  display: flex; gap: 0.5rem; z-index: 200;
}
#backupBar button {
  padding: 0.38rem 0.85rem;
  border-radius: 20px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.62rem; letter-spacing: 0.08em;
  cursor: pointer; border: 1px solid var(--border);
  transition: all 0.2s;
}
#backupBar .bb-export { background: rgba(201,168,76,0.12); color: var(--brass2); }
#backupBar .bb-import { background: rgba(46,107,138,0.18); color: var(--foam); }
#backupBar .bb-reset  { background: rgba(192,57,43,0.12); color: #e87e74; }
#backupBar button:hover { filter: brightness(1.3); }
</style>

<div id="saveIndicator">‚úì Â∑≤ÂÑ≤Â≠ò</div>
<div id="backupBar">
  <button class="bb-export" onclick="exportBackup()" title="ÂåØÂá∫ÂÇô‰ªΩ JSON">‚¨á<span class="bb-text"> ÂÇô‰ªΩ</span></button>
  <button class="bb-import" onclick="importBackup()" title="ÂæûÂÇô‰ªΩÈÇÑÂéü">‚¨Ü<span class="bb-text"> ÈÇÑÂéü</span></button>
  <button class="bb-reset"  onclick="resetAll()"     title="Ê∏ÖÈô§ÊâÄÊúâË≥áÊñô">‚Ü∫<span class="bb-text"> ÈáçÁΩÆ</span></button>
</div>
</body>
</html>
